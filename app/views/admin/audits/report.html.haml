%h1 Audit Log

#tabs-wrapper.AdminTabSet
  %ul#report-tabs.AdminTabNav
    %li= link_to "Browse by Date", admin_audits_path
    %li.Selected
      %span Custom Report
  .ClearFix <!-- do not remove -->
.ClearFix <!-- do not remove -->

%h2.Block Custom Report

- form_tag report_admin_audits_path, :method => "get", :id => "audit_filter_form", :class => "BlockForm" do
  %fieldset#custom-report-fieldset

    %legend Report Query

    %table
      %col{ :width => "50%" }
      %col{ :width => "25%" }
      %col{ :width => "25%" }
      %tbody
        %tr
          %td
            %label{ :for => "startdate" } Date Range
            = text_field_tag :startdate, params[:after]
            %label.Smaller{ :for => "enddate" } to
            = text_field_tag :enddate, params[:before]

          %td
            %label{ :for => "filter[ip_address]" } IP Address
            = text_field_tag "filter[ip_address]", params[:ip]

          %td
            %label{ :for => "filter[user_id]" } User ID
            = text_field_tag "filter[user_id]", params[:user]
        %tr
          %td
            %label{ :for => "filter[auditable_type]" } Object Kind
            = text_field_tag "filter[auditable_type]", params[:auditable_type]
            %label.Smaller{ :for => "filter[auditable_id]" } Object ID
            = text_field_tag "filter[auditable_id]", params[:auditable_id]

          %td
            %label{ :for => "audit_type_name" } Event Type
            = text_field_tag :audit_type_name, params[:event_type]

          %td
            %label{ :for => "query" } Message
            = text_field_tag :query, params[:log]

    .FormAction
      = submit_tag "Apply Filter"
      = link_to "Remove Filter", report_admin_audits_path, :class => "Small", :id => "remove-filters" if custom_report_filters_set?

  .ClearFix <!-- do not remove -->

%p#total-audit-display
  Showing
  %strong= @audits.size
  = "of #{AuditEvent.count} total events"
  
#top-report-pagination.Top=will_paginate @audits, :previous_label => "Previous", :next_label => "Next"

.ClearFix <!-- do not remove -->

%table#audit-results.index
  %thead
    %tr
      %th= link_to "Date / Time", overwrite_params(:direction => reverse_direction)
      %th= "IP Address"
      %th= "User"
      %th= "Event Type"
      %th= "Message"
  %tbody
    - if @audits.size == 0
      %tr
        %td.Placeholder{ :colspan => 5 }
          %p= "No events that match the criteria exist for this day."
    - else
      -@audits.each do |a|
        %tr
          %td= a.created_at.to_s(:mdy_time)
          %td= a.ip_address
          %td= a.user.nil? ? "(Unknown)" : a.user.login
          %td= a.event_type
          %td= a.log_message

.Bottom= will_paginate @audits, :previous_label => "Previous", :next_label => "Next"